<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="./styles/style.css">
        <title>Muldoon</title>
        <script src="./libs/plotly-2.18.2.min.js"></script>
        <script src="./libs/d3.v7.min.js"></script>
    </head>
    <body>
        <div id="titleBar">
            <img src="./images/logo1.png" id="logo">
            <h1>Muldoon</h1>
        </div>
        <div id="navBar">
            <a href="">Home</a>
            <a>Graphs</a>
            <a href="https://atmos.nmsu.edu/data_and_services/atmospheres_data/PERSEVERANCE/meda.html">MEDA</a>
            <a>Astrojack</a>
        </div>
        <div id="content">
            <div id="graphInput">
                <label id="solLabel" for="sol">Sol (1-n):</label>
                <input type="number" id="sol" name="sol" min="1" max="10" value="1">
                <br>
                <label for="startTime">Graph Start Time (hh:mm:ss):</label>
                <input type="text" id="startTime" name="startTime" value="00:00:00" size="8" pattern="^(([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9])|(24:[0-2][0-9]:[0-5][0-9])|(24:3[0-8]:[0-5][0-9])|(24:39:([0-2][0-9]|3[0-4]))$">
                <br>
                <label for="endTime">Graph End Time (hh:mm:ss):</label>
                <input type="text" id="endTime" name="endTime" value="24:39:35" size="8" pattern="^(([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9])|(24:[0-2][0-9]:[0-5][0-9])|(24:3[0-8]:[0-5][0-9])|(24:39:([0-2][0-9]|3[0-5]))$">
                <br>
                <label for="sensorId">Sensor:</label>
                <select id="sensorId">
                    <!--<option value="ANCILLARY">Ancillary (ANC)</option>-->
                    <option value="PS" selected>Pressure (PS)</option>
                    <option value="RHS">Relative Humidity (RHS)</option>
                    <option value="TIRS">Thermal Infared (TIR)</option>
                    <option value="WS">Wind (WS)</option>
                </select>
                <br>
                <button id="plotGraphBtn">Plot Graph</button>
                <br>
                <p>
                    To generate a graph, first select a sol number to view.
                    Optionally, adjust the graph start and end times to view range subset of the data from the selected sol.
                    Check if the graph should display the wind speed and/or air pressure and finally click the 'Plot Graph' button to generate the graph.
                </p>
                <p>
                    After generating the graph it can be interacted with by (TODO: add interaction instructions after implementation)
                </p>
                <p>
                    The currently viewed graph may also be exported and shared either as an image, or as a url which will link back to the same graph with the same settings.
                    To do so, click the 'Export Image' or 'Export URL' buttons respectively.
                </p>
            </div>
            <div id="graph"></div>
            <!-- 
            <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js" integrity="sha512-SGWgwwRA8xZgEoKiex3UubkSkV1zSE1BS6O4pXcaxcNtUlQsOmOmhVnDwIvqGRfEmuz83tIGL13cXMZn6upPyg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
            <canvas id="myChart"></canvas>
            <script>
                async function exportImage(){
                    let element = document.createElement('a');
                    element.href = chart.toBase64Image();
                    element.download = 'graph_export.png';
                    element.click();
                }

                async function exportURL(){
                    let urlBuilder = new URLSearchParams();
                    urlBuilder.set('x1', chart.scales.x.min);
                    urlBuilder.set('x2', chart.scales.x.max);
                    urlBuilder.set('y1', chart.scales.y.min);
                    urlBuilder.set('y2', chart.scales.y.max);
                    document.getElementById('urlDisplay').innerHTML = 'URL Exported: ' + window.location.origin + window.location.pathname + '?' + urlBuilder.toString();
                }
            </script>


                  
            <div id="export">
                <button onclick="exportImage()">Export Image</button>
                <button onclick="exportURL()">Export URL</button>
                <span id="urlDisplay"></span>
            </div>
            -->
        </div>
        <div id="footerBar">
            <div class="aligned">
                <img src="./images/sdp-logo-3.png" height="48px" />
                <span>Boise State University</span>
            </div>
        </div>

        <script src="./js/muldoon.js"></script>
        <script src="./js/meda-chart.js"></script>
    </body>
</html>